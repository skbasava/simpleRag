ADDRESS_RANGE_RE = re.compile(
    r"(0x[0-9A-Fa-f]+)\s*-\s*(0x[0-9A-Fa-f]+)"
)

ADDRESS_SINGLE_RE = re.compile(
    r"(0x[0-9A-Fa-f]+)"
)

def extract_address(text: str) -> tuple[int | None, int | None]:
    if not text:
        return None, None

    # 1Ô∏è‚É£ Range match first
    m = ADDRESS_RANGE_RE.search(text)
    if m:
        start = int(m.group(1), 16)
        end   = int(m.group(2), 16)
        return start, end

    # 2Ô∏è‚É£ Single address
    m = ADDRESS_SINGLE_RE.search(text)
    if m:
        addr = int(m.group(1), 16)
        return addr, addr

    # 3Ô∏è‚É£ No address mentioned
    return None, None




-- Drop vector + chunk tables explicitly

DROP TABLE IF EXISTS xml_chunks CASCADE;
DROP TABLE IF EXISTS ingestion_progress CASCADE;

-- If you created auxiliary tables
DROP TABLE IF EXISTS rag_jobs CASCADE;
DROP TABLE IF EXISTS rag_logs CASCADE;


#!/usr/bin/env bash
set -e

echo "=============================="
echo "RAG SYSTEM ‚Äì FULL CLEAN & REBUILD"
echo "=============================="

echo ""
echo "üîª Step 1: Stop containers"
docker compose down --remove-orphans

echo ""
echo "üóëÔ∏è  Step 2: Remove volumes (Postgres data)"
docker compose down -v

echo ""
echo "üåê Step 3: Remove project networks"
docker network prune -f

echo ""
echo "üßπ Step 4: Remove dangling images"
docker image prune -f

echo ""
echo "üî® Step 5: Rebuild images (no cache)"
docker compose build --no-cache

echo ""
echo "üöÄ Step 6: Start Postgres only"
docker compose up -d postgres

echo "‚è≥ Waiting for Postgres to be ready..."
sleep 8

echo ""
echo "üß® Step 7: Drop Postgres tables"
docker compose exec -T postgres \
  psql -U postgres -d ragdb -f /cleanup_postgres.sql

echo ""
echo "üöÄ Step 8: Start all services"
docker compose up -d

echo ""
echo "‚úÖ Rebuild complete"
docker compose ps


ADDRESS_RANGE_RE = re.compile(
    r"(0x[0-9A-Fa-f]+)\s*-\s*(0x[0-9A-Fa-f]+)"
)

def extract_address_range(text: str):
    m = ADDRESS_RANGE_RE.search(text)
    if not m:
        return None, None
    return m.group(1), m.group(2)
